Ç

GC:\Users\Cam\source\repos\cgoncalves\Repository\ApplicationDbContext.cs
	namespace 	
TestApiRest
 
{ 
public 

class  
ApplicationDbContext %
:& '
	DbContext( 1
{ 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
options5 <
)< =
:= >
base> B
(C D
optionsD K
)K L
{		 	
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Book 
> 
Books  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Order 
> 
Orders "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
DbSet 
< 
OrderDetail  
>  !
OrderDetails" .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
} 
} ¨8
BC:\Users\Cam\source\repos\cgoncalves\Repository\BooksRepository.cs
	namespace

 	
TestApiRest


 
.

 

Repository

  
{ 
public 

class 
BooksRepository  
:! "
IBooksRepository# 3
{ 
private 
readonly  
ApplicationDbContext -

_dbContext. 8
;8 9
private 
readonly 
IMapper  
_mapper! (
;( )
public 
BooksRepository 
(  
ApplicationDbContext 3
	dbContext4 =
,= >
IMapper? F
mapperG M
)M N
{ 	

_dbContext 
= 
	dbContext !
;! "
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
List 
< 
BookDTO &
>& '
>' (
GetAllBooks) 4
(4 5
)5 6
{ 	
var 
books 
= 
await 

_dbContext (
.( )
Books) .
.. /
ToListAsync/ :
(: ;
); <
;< =
return 
_mapper 
. 
Map 
< 
List #
<# $
BookDTO$ +
>+ ,
>, -
(- .
books. 3
)3 4
;4 5
} 	
public 
async 
Task 
< 
BookDTO !
>! "
GetBookById# .
(. /
int/ 2
id3 5
)5 6
{ 	
var 
book 
= 
await 

_dbContext '
.' (
Books( -
.- .
AsNoTracking. :
(: ;
); <
.< =
FirstOrDefaultAsync= P
(P Q
xQ R
=>S U
xV W
.W X
IdBookX ^
==_ a
idb d
)d e
;e f
if 
( 
book 
== 
null 
) 
{   
throw!! 
new!!  
KeyNotFoundException!! .
(!!. /
$str!!/ K
)!!K L
;!!L M
}"" 
return## 
_mapper## 
.## 
Map## 
<## 
BookDTO## &
>##& '
(##' (
book##( ,
)##, -
;##- .
}$$ 	
public%% 
async%% 
Task%% 
<%% 
BookDTO%% !
>%%! "

CreateBook%%# -
(%%- .
BookDTO%%. 5
book%%6 :
)%%: ;
{&& 	
var'' 
newBook'' 
='' 
_mapper'' !
.''! "
Map''" %
<''% &
Book''& *
>''* +
(''+ ,
book'', 0
)''0 1
;''1 2

_dbContext(( 
.(( 
Books(( 
.(( 
Add((  
(((  !
newBook((! (
)((( )
;(() *
await)) 

_dbContext)) 
.)) 
SaveChangesAsync)) -
())- .
))). /
;))/ 0
return** 
_mapper** 
.** 
Map** 
<** 
BookDTO** &
>**& '
(**' (
newBook**( /
)**/ 0
;**0 1
}++ 	
public-- 
async-- 
Task-- 
<-- 
BookDTO-- !
>--! "

UpdateBook--# -
(--- .
BookDTO--. 5
bookDTO--6 =
)--= >
{.. 	
var// 
book// 
=// 
GetBookById// "
(//" #
bookDTO//# *
.//* +
IdBook//+ 1
)//1 2
;//2 3
if00 
(00 
book00 
is00 
null00 
)00 
throw11 
new11 
ExceptionMessage11 *
(11* +
$str11+ E
)11E F
;11F G
var33 
updatedBook33 
=33 
_mapper33 %
.33% &
Map33& )
<33) *
Book33* .
>33. /
(33/ 0
bookDTO330 7
)337 8
;338 9

_dbContext44 
.44 
Update44 
(44 
updatedBook44 )
)44) *
;44* +
await55 

_dbContext55 
.55 
SaveChangesAsync55 -
(55- .
)55. /
;55/ 0
return66 
await66 
GetBookById66 $
(66$ %
updatedBook66% 0
.660 1
IdBook661 7
)667 8
;668 9
}77 	
public99 
async99 
Task99 
<99 
BookDTO99 !
>99! "

DeleteBook99# -
(99- .
int99. 1
id992 4
)994 5
{:: 	
var;; 
book;; 
=;; 
await;; 

_dbContext;; '
.;;' (
Books;;( -
.;;- .
	FindAsync;;. 7
(;;7 8
id;;8 :
);;: ;
;;;; <
if<< 
(<< 
book<< 
is<< 
null<< 
)<< 
{== 
throw>> 
new>>  
KeyNotFoundException>> .
(>>. /
$str>>/ I
)>>I J
;>>J K
}?? 

_dbContext@@ 
.@@ 
Books@@ 
.@@ 
Remove@@ #
(@@# $
book@@$ (
)@@( )
;@@) *
awaitAA 

_dbContextAA 
.AA 
SaveChangesAsyncAA -
(AA- .
)AA. /
;AA/ 0
returnBB 
_mapperBB 
.BB 
MapBB 
<BB 
BookDTOBB &
>BB& '
(BB' (
bookBB( ,
)BB, -
;BB- .
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
ListEE 
<EE 
BookDTOEE &
>EE& '
>EE' (
	SaveBooksEE) 2
(EE2 3
ListEE3 7
<EE7 8
BookDTOEE8 ?
>EE? @
booksDtoEEA I
)EEI J
{FF 	
varGG 
booksGG 
=GG 
_mapperGG 
.GG  
MapGG  #
<GG# $
ListGG$ (
<GG( )
BookGG) -
>GG- .
>GG. /
(GG/ 0
booksDtoGG0 8
)GG8 9
;GG9 :
awaitHH 

_dbContextHH 
.HH 
BooksHH "
.HH" #
AddRangeAsyncHH# 0
(HH0 1
booksHH1 6
)HH6 7
;HH7 8

_dbContextII 
.II 
SaveChangesII "
(II" #
)II# $
;II$ %
returnJJ 
_mapperJJ 
.JJ 
MapJJ 
<JJ 
ListJJ #
<JJ# $
BookDTOJJ$ +
>JJ+ ,
>JJ, -
(JJ- .
booksJJ. 3
)JJ3 4
;JJ4 5
}KK 	
}LL 
}MM Û
NC:\Users\Cam\source\repos\cgoncalves\Repository\Interfaces\IBooksRepository.cs
	namespace 	
TestApiRest
 
. 

Repository  
.  !

Interfaces! +
{ 
public 

	interface 
IBooksRepository %
{ 
Task 
< 
List 
< 
BookDTO 
> 
> 
GetAllBooks '
(' (
)( )
;) *
Task 
< 
BookDTO 
> 
GetBookById !
(! "
int" %
id& (
)( )
;) *
Task		 
<		 
BookDTO		 
>		 

CreateBook		  
(		  !
BookDTO		! (
bookDTO		) 0
)		0 1
;		1 2
Task

 
<

 
BookDTO

 
>

 

UpdateBook

  
(

  !
BookDTO

! (
bookDTO

) 0
)

0 1
;

1 2
Task 
< 
BookDTO 
> 

DeleteBook  
(  !
int! $
id% '
)' (
;( )
Task 
< 
List 
< 
BookDTO 
> 
> 
	SaveBooks %
(% &
List& *
<* +
BookDTO+ 2
>2 3
booksDto4 <
)< =
;= >
} 
} ë	
OC:\Users\Cam\source\repos\cgoncalves\Repository\Interfaces\IOrdersRepository.cs
	namespace 	
TestApiRest
 
. 

Repository  
.  !

Interfaces! +
{ 
public 

	interface 
IOrdersRepository &
{ 
Task 
< 
List 
< 
OrderDTO 
> 
> 
GetAllOrders )
() *
)* +
;+ ,
Task		 
<		 
OrderDTO		 
>		 
GetOrderById		 #
(		# $
int		$ '
id		( *
)		* +
;		+ ,
Task

 
<

 
OrderDTO

 
>

 
CreateOrder

 "
(

" #
OrderDTO

# +
orderDTO

, 4
)

4 5
;

5 6
Task 
< 
OrderDTO 
> 
DeleteOrder "
(" #
int# &
id' )
)) *
;* +
Task 
< 
byte 
[ 
] 
> 
DownloadPDF  
(  !
int! $
orderId% ,
), -
;- .
} 
} Á	
NC:\Users\Cam\source\repos\cgoncalves\Repository\Interfaces\IUsersRepository.cs
	namespace 	
TestApiRest
 
. 

Repository  
.  !

Interfaces! +
{ 
public 

	interface 
IUsersRepository %
{ 
Task 
< 
List 
< 
UserDTO 
> 
> 
GetAllUsers '
(' (
)( )
;) *
Task 
< 
UserDTO 
> 
GetUserById !
(! "
int" %
id& (
)( )
;) *
Task		 
<		 
UserDTO		 
>		 

CreateUser		  
(		  !
UserDTO		! (
user		) -
)		- .
;		. /
Task

 
<

 
UserDTO

 
>

 

UpdateUser

  
(

  !
UserDTO

! (
user

) -
)

- .
;

. /
Task 
< 
UserDTO 
> 

DeleteUser  
(  !
int! $
id% '
)' (
;( )
} 
} ù\
TC:\Users\Cam\source\repos\cgoncalves\Repository\Migrations\20230823172914_Initial.cs
	namespace 	

Repository
 
. 

Migrations 
{ 
public		 

partial		 
class		 
Initial		  
:		! "
	Migration		# ,
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
IdBook 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Tittle 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 G
,G H
	maxLengthI R
:R S
$numT W
,W X
nullableY a
:a b
falsec h
)h i
,i j
	Publisher 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; I
,I J
	maxLengthK T
:T U
$numV X
,X Y
nullableZ b
:b c
falsed i
)i j
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
IdBook8 >
)> ?
;? @
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
IdUser   
=   
table   "
.  " #
Column  # )
<  ) *
int  * -
>  - .
(  . /
type  / 3
:  3 4
$str  5 :
,  : ;
nullable  < D
:  D E
false  F K
)  K L
.!! 

Annotation!! #
(!!# $
$str!!$ 8
,!!8 9
$str!!: @
)!!@ A
,!!A B
Name"" 
="" 
table""  
.""  !
Column""! '
<""' (
string""( .
>"". /
(""/ 0
type""0 4
:""4 5
$str""6 D
,""D E
	maxLength""F O
:""O P
$num""Q S
,""S T
nullable""U ]
:""] ^
false""_ d
)""d e
,""e f
Surname## 
=## 
table## #
.### $
Column##$ *
<##* +
string##+ 1
>##1 2
(##2 3
type##3 7
:##7 8
$str##9 G
,##G H
	maxLength##I R
:##R S
$num##T V
,##V W
nullable##X `
:##` a
false##b g
)##g h
,##h i
TypeOfDocument$$ "
=$$# $
table$$% *
.$$* +
Column$$+ 1
<$$1 2
int$$2 5
>$$5 6
($$6 7
type$$7 ;
:$$; <
$str$$= B
,$$B C
	maxLength$$D M
:$$M N
$num$$O Q
,$$Q R
nullable$$S [
:$$[ \
false$$] b
)$$b c
,$$c d
DocumentNumber%% "
=%%# $
table%%% *
.%%* +
Column%%+ 1
<%%1 2
int%%2 5
>%%5 6
(%%6 7
type%%7 ;
:%%; <
$str%%= B
,%%B C
nullable%%D L
:%%L M
false%%N S
)%%S T
,%%T U
DateOfBirth&& 
=&&  !
table&&" '
.&&' (
Column&&( .
<&&. /
DateTime&&/ 7
>&&7 8
(&&8 9
type&&9 =
:&&= >
$str&&? E
,&&E F
nullable&&G O
:&&O P
false&&Q V
)&&V W
}'' 
,'' 
constraints(( 
:(( 
table(( "
=>((# %
{)) 
table** 
.** 

PrimaryKey** $
(**$ %
$str**% /
,**/ 0
x**1 2
=>**3 5
x**6 7
.**7 8
IdUser**8 >
)**> ?
;**? @
}++ 
)++ 
;++ 
migrationBuilder-- 
.-- 
CreateTable-- (
(--( )
name.. 
:.. 
$str.. 
,.. 
columns// 
:// 
table// 
=>// !
new//" %
{00 
IdOrder11 
=11 
table11 #
.11# $
Column11$ *
<11* +
int11+ .
>11. /
(11/ 0
type110 4
:114 5
$str116 ;
,11; <
nullable11= E
:11E F
false11G L
)11L M
.22 

Annotation22 #
(22# $
$str22$ 8
,228 9
$str22: @
)22@ A
,22A B
IdUser33 
=33 
table33 "
.33" #
Column33# )
<33) *
int33* -
>33- .
(33. /
type33/ 3
:333 4
$str335 :
,33: ;
nullable33< D
:33D E
false33F K
)33K L
,33L M
DateOfOrder44 
=44  !
table44" '
.44' (
Column44( .
<44. /
DateTime44/ 7
>447 8
(448 9
type449 =
:44= >
$str44? E
,44E F
nullable44G O
:44O P
false44Q V
)44V W
}55 
,55 
constraints66 
:66 
table66 "
=>66# %
{77 
table88 
.88 

PrimaryKey88 $
(88$ %
$str88% 0
,880 1
x882 3
=>884 6
x887 8
.888 9
IdOrder889 @
)88@ A
;88A B
table99 
.99 

ForeignKey99 $
(99$ %
name:: 
::: 
$str:: 6
,::6 7
column;; 
:;; 
x;;  !
=>;;" $
x;;% &
.;;& '
IdUser;;' -
,;;- .
principalTable<< &
:<<& '
$str<<( /
,<</ 0
principalColumn== '
:==' (
$str==) 1
,==1 2
onDelete>>  
:>>  !
ReferentialAction>>" 3
.>>3 4
Cascade>>4 ;
)>>; <
;>>< =
}?? 
)?? 
;?? 
migrationBuilderAA 
.AA 
CreateTableAA (
(AA( )
nameBB 
:BB 
$strBB $
,BB$ %
columnsCC 
:CC 
tableCC 
=>CC !
newCC" %
{DD 
IdDetailEE 
=EE 
tableEE $
.EE$ %
ColumnEE% +
<EE+ ,
intEE, /
>EE/ 0
(EE0 1
typeEE1 5
:EE5 6
$strEE7 <
,EE< =
nullableEE> F
:EEF G
falseEEH M
)EEM N
.FF 

AnnotationFF #
(FF# $
$strFF$ 8
,FF8 9
$strFF: @
)FF@ A
,FFA B
IdOrderGG 
=GG 
tableGG #
.GG# $
ColumnGG$ *
<GG* +
intGG+ .
>GG. /
(GG/ 0
typeGG0 4
:GG4 5
$strGG6 ;
,GG; <
nullableGG= E
:GGE F
falseGGG L
)GGL M
,GGM N
IdBookHH 
=HH 
tableHH "
.HH" #
ColumnHH# )
<HH) *
intHH* -
>HH- .
(HH. /
typeHH/ 3
:HH3 4
$strHH5 :
,HH: ;
nullableHH< D
:HHD E
falseHHF K
)HHK L
}II 
,II 
constraintsJJ 
:JJ 
tableJJ "
=>JJ# %
{KK 
tableLL 
.LL 

PrimaryKeyLL $
(LL$ %
$strLL% 6
,LL6 7
xLL8 9
=>LL: <
xLL= >
.LL> ?
IdDetailLL? G
)LLG H
;LLH I
tableMM 
.MM 

ForeignKeyMM $
(MM$ %
nameNN 
:NN 
$strNN <
,NN< =
columnOO 
:OO 
xOO  !
=>OO" $
xOO% &
.OO& '
IdBookOO' -
,OO- .
principalTablePP &
:PP& '
$strPP( /
,PP/ 0
principalColumnQQ '
:QQ' (
$strQQ) 1
,QQ1 2
onDeleteRR  
:RR  !
ReferentialActionRR" 3
.RR3 4
CascadeRR4 ;
)RR; <
;RR< =
tableSS 
.SS 

ForeignKeySS $
(SS$ %
nameTT 
:TT 
$strTT >
,TT> ?
columnUU 
:UU 
xUU  !
=>UU" $
xUU% &
.UU& '
IdOrderUU' .
,UU. /
principalTableVV &
:VV& '
$strVV( 0
,VV0 1
principalColumnWW '
:WW' (
$strWW) 2
,WW2 3
onDeleteXX  
:XX  !
ReferentialActionXX" 3
.XX3 4
CascadeXX4 ;
)XX; <
;XX< =
}YY 
)YY 
;YY 
migrationBuilder[[ 
.[[ 
CreateIndex[[ (
([[( )
name\\ 
:\\ 
$str\\ .
,\\. /
table]] 
:]] 
$str]] %
,]]% &
column^^ 
:^^ 
$str^^  
)^^  !
;^^! "
migrationBuilder`` 
.`` 
CreateIndex`` (
(``( )
nameaa 
:aa 
$straa /
,aa/ 0
tablebb 
:bb 
$strbb %
,bb% &
columncc 
:cc 
$strcc !
)cc! "
;cc" #
migrationBuilderee 
.ee 
CreateIndexee (
(ee( )
nameff 
:ff 
$strff (
,ff( )
tablegg 
:gg 
$strgg 
,gg  
columnhh 
:hh 
$strhh  
)hh  !
;hh! "
}ii 	
	protectedll 
overridell 
voidll 
Downll  $
(ll$ %
MigrationBuilderll% 5
migrationBuilderll6 F
)llF G
{mm 	
migrationBuildernn 
.nn 
	DropTablenn &
(nn& '
nameoo 
:oo 
$stroo $
)oo$ %
;oo% &
migrationBuilderqq 
.qq 
	DropTableqq &
(qq& '
namerr 
:rr 
$strrr 
)rr 
;rr 
migrationBuildertt 
.tt 
	DropTablett &
(tt& '
nameuu 
:uu 
$struu 
)uu 
;uu  
migrationBuilderww 
.ww 
	DropTableww &
(ww& '
namexx 
:xx 
$strxx 
)xx 
;xx 
}yy 	
}zz 
}{{ E
CC:\Users\Cam\source\repos\cgoncalves\Repository\OrdersRepository.cs
	namespace 	
TestApiRest
 
. 

Repository  
{ 
public 

class 
OrdersRepository !
:" #
IOrdersRepository$ 5
{ 
private 
readonly  
ApplicationDbContext -

_dbContext. 8
;8 9
private 
readonly 
IMapper  
_mapper! (
;( )
public 
OrdersRepository 
(   
ApplicationDbContext  4
	dbContext5 >
,> ?
IMapper@ G
mapperH N
)N O
{ 	

_dbContext 
= 
	dbContext "
;" #
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
List 
< 
OrderDTO '
>' (
>( )
GetAllOrders* 6
(6 7
)7 8
{ 	
var 
orders 
= 
await 

_dbContext )
.) *
Orders* 0
.0 1
ToListAsync1 <
(< =
)= >
;> ?
return 
_mapper 
. 
Map 
< 
List #
<# $
OrderDTO$ ,
>, -
>- .
(. /
orders/ 5
)5 6
;6 7
} 	
public 
async 
Task 
< 
OrderDTO "
>" #
GetOrderById$ 0
(0 1
int1 4
id5 7
)7 8
{ 	
var   
order   
=   
await   

_dbContext   (
.  ( )
Orders  ) /
.  / 0
	FindAsync  0 9
(  9 :
id  : <
)  < =
;  = >
if!! 
(!! 
order!! 
==!! 
null!! 
)!! 
{"" 
throw## 
new##  
KeyNotFoundException## .
(##. /
$str##/ M
)##M N
;##N O
}$$ 
return%% 
_mapper%% 
.%% 
Map%% 
<%% 
OrderDTO%% '
>%%' (
(%%( )
order%%) .
)%%. /
;%%/ 0
}&& 	
public(( 
async(( 
Task(( 
<(( 
OrderDTO(( "
>((" #
CreateOrder(($ /
(((/ 0
OrderDTO((0 8
orderDTO((9 A
)((A B
{)) 	
var** 
order** 
=** 
_mapper** 
.**  
Map**  #
<**# $
Order**$ )
>**) *
(*** +
orderDTO**+ 3
)**3 4
;**4 5

_dbContext++ 
.++ 
Orders++ 
.++ 
Add++ !
(++! "
order++" '
)++' (
;++( )
await,, 

_dbContext,, 
.,, 
SaveChangesAsync,, -
(,,- .
),,. /
;,,/ 0
return-- 
orderDTO-- 
;-- 
}.. 	
public00 
async00 
Task00 
<00 
OrderDTO00 "
>00" #
DeleteOrder00$ /
(00/ 0
int000 3
id004 6
)006 7
{11 	
var22 
order22 
=22 
await22 

_dbContext22 (
.22( )
Orders22) /
.22/ 0
	FindAsync220 9
(229 :
id22: <
)22< =
;22= >
if33 
(33 
order33 
!=33 
null33 
)33 
{44 
throw55 
new55  
KeyNotFoundException55 .
(55. /
$str55/ J
)55J K
;55K L
}66 

_dbContext77 
.77 
Orders77 
.77 
Remove77 $
(77$ %
order77% *
)77* +
;77+ ,
await88 

_dbContext88 
.88 
SaveChangesAsync88 -
(88- .
)88. /
;88/ 0
return99 
_mapper99 
.99 
Map99 
<99 
OrderDTO99 '
>99' (
(99( )
order99) .
)99. /
;99/ 0
}:: 	
public<< 
async<< 
Task<< 
<<< 
byte<< 
[<< 
]<<  
><<  !
DownloadPDF<<" -
(<<- .
int<<. 1
orderId<<2 9
)<<9 :
{== 	
try>> 
{?? 
var@@ 
order@@ 
=@@ 
await@@ !

_dbContext@@" ,
.@@, -
Orders@@- 3
.AA 
IncludeAA 
(AA 
oAA 
=>AA !
oAA" #
.AA# $
UserAA$ (
)AA( )
.BB 
FirstOrDefaultAsyncBB (
(BB( )
oBB) *
=>BB+ -
oBB. /
.BB/ 0
IdOrderBB0 7
==BB8 :
orderIdBB; B
)BBB C
;BBC D
ifDD 
(DD 
orderDD 
==DD 
nullDD !
)DD! "
{EE 
throwFF 
newFF 
BadRequestExceptionFF 1
(FF1 2
$strFF2 M
)FFM N
;FFN O
}GG 
varII 
userII 
=II 
awaitII  

_dbContextII! +
.II+ ,
UsersII, 1
.II1 2
	FindAsyncII2 ;
(II; <
orderII< A
.IIA B
UserIIB F
.IIF G
IdUserIIG M
)IIM N
;IIN O
varJJ 
orderDetailsJJ  
=JJ! "
awaitJJ# (

_dbContextJJ) 3
.JJ3 4
OrderDetailsJJ4 @
.JJ@ A
WhereJJA F
(JJF G
xJJG H
=>JJI K
xJJL M
.JJM N
IdOrderJJN U
==JJV X
orderJJY ^
.JJ^ _
IdOrderJJ_ f
)JJf g
.JJg h
ToListAsyncJJh s
(JJs t
)JJt u
;JJu v
varKK 
bookIdsKK 
=KK 
orderDetailsKK *
.KK* +
SelectKK+ 1
(KK1 2
xKK2 3
=>KK4 6
xKK7 8
.KK8 9
IdBookKK9 ?
)KK? @
;KK@ A
varLL 
booksLL 
=LL 
awaitLL !

_dbContextLL" ,
.LL, -
BooksLL- 2
.LL2 3
WhereLL3 8
(LL8 9
bookLL9 =
=>LL> @
bookIdsLLA H
.LLH I
ContainsLLI Q
(LLQ R
bookLLR V
.LLV W
IdBookLLW ]
)LL] ^
)LL^ _
.LL_ `
ToListAsyncLL` k
(LLk l
)LLl m
;LLm n
varNN 
orderDtoNN 
=NN 
_mapperNN &
.NN& '
MapNN' *
<NN* +
OrderDTONN+ 3
>NN3 4
(NN4 5
orderNN5 :
)NN: ;
;NN; <
varOO 
userDtoOO 
=OO 
_mapperOO %
.OO% &
MapOO& )
<OO) *
UserDTOOO* 1
>OO1 2
(OO2 3
userOO3 7
)OO7 8
;OO8 9
varPP 
orderDetailsDTOPP #
=PP$ %
_mapperPP& -
.PP- .
MapPP. 1
<PP1 2
ListPP2 6
<PP6 7
OrderDetailDTOPP7 E
>PPE F
>PPF G
(PPG H
orderDetailsPPH T
)PPT U
;PPU V
varQQ 
booksDTOQQ 
=QQ 
_mapperQQ &
.QQ& '
MapQQ' *
<QQ* +
ListQQ+ /
<QQ/ 0
BookDTOQQ0 7
>QQ7 8
>QQ8 9
(QQ9 :
booksQQ: ?
)QQ? @
;QQ@ A
stringSS 
pdfFilePathSS "
=SS# $"
CreateWithPDFSharpCoreSS% ;
.SS; <
GeneratePathSS< H
(SSH I
$strSSI S
)SSS T
;SST U
varTT 
pdfBytesTT 
=TT "
CreateWithPDFSharpCoreTT 5
.TT5 6
	CreatePDFTT6 ?
(TT? @
pdfFilePathTT@ K
,TTK L
orderDtoTTL T
,TTT U
userDtoTTV ]
,TT] ^
orderDetailsDTOTT_ n
,TTn o
booksDTOTTp x
)TTx y
;TTy z
returnVV 
pdfBytesVV 
;VV  
}WW 
catchXX 
(XX 
	ExceptionXX 
)XX 
{YY 
throwZZ 
newZZ 
ExceptionMessageZZ *
(ZZ* +
$strZZ+ O
)ZZO P
;ZZP Q
}[[ 
}\\ 	
}]] 
}^^ @
BC:\Users\Cam\source\repos\cgoncalves\Repository\UsersRepository.cs
	namespace 	
TestApiRest
 
. 

Repository  
{		 
public

 

class

 
UsersRepository

  
:

! "
IUsersRepository

# 3
{ 
private 
readonly  
ApplicationDbContext -

_dbContext. 8
;8 9
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UsersRepository 
(  
ApplicationDbContext 3
	dbContext4 =
,= >
IMapper? F
mapperG M
)M N
{ 	

_dbContext 
= 
	dbContext "
;" #
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
List 
< 
UserDTO &
>& '
>' (
GetAllUsers) 4
(4 5
)5 6
{ 	
var 
users 
= 
await 

_dbContext (
.( )
Users) .
.. /
ToListAsync/ :
(: ;
); <
;< =
return 
_mapper 
. 
Map 
< 
List #
<# $
UserDTO$ +
>+ ,
>, -
(- .
users. 3
)3 4
;4 5
} 	
public 
async 
Task 
< 
UserDTO !
>! "
GetUserById# .
(. /
int/ 2
id3 5
)5 6
{ 	
var 
user 
= 
await 

_dbContext '
.' (
Users( -
.- .
AsNoTracking. :
(: ;
); <
.< =
FirstOrDefaultAsync= P
(P Q
uQ R
=>S U
uV W
.W X
IdUserX ^
==_ a
idb d
)d e
;e f
if 
( 
user 
== 
null 
) 
{ 
throw   
new    
KeyNotFoundException   .
(  . /
$str  / X
)  X Y
;  Y Z
}!! 
return"" 
_mapper"" 
."" 
Map"" 
<"" 
UserDTO"" &
>""& '
(""' (
user""( ,
)"", -
;""- .
}## 	
public%% 
async%% 
Task%% 
<%% 
UserDTO%% !
>%%! "

CreateUser%%# -
(%%- .
UserDTO%%. 5
userDto%%6 =
)%%= >
{&& 	
bool'' 
	userExist'' 
='' 
await'' "

_dbContext''# -
.''- .
Users''. 3
.''3 4
AnyAsync''4 <
(''< =
x''= >
=>''? A
x''B C
.''C D
DocumentNumber''D R
==''S U
userDto''V ]
.''] ^
DocumentNumber''^ l
)''l m
;''m n
if(( 
((( 
	userExist(( 
)(( 
throw)) 
new)) 
BadRequestException)) -
())- .
$str)). a
)))a b
;))b c
if++ 
(++ 
(++ 
int++ 
)++ 
userDto++ 
.++ 
TypeOfDocument++ +
>++, -
(++. /
int++/ 2
)++2 3
Enum++3 7
.++7 8
	GetValues++8 A
(++A B
typeof++B H
(++H I
TypeOfDocument++I W
)++W X
)++X Y
.++Y Z
Cast++Z ^
<++^ _
TypeOfDocument++_ m
>++m n
(++n o
)++o p
.++p q
Max++q t
(++t u
)++u v
||,, 
(,, 
int,, 
),, 
userDto,, 
.,,  
TypeOfDocument,,  .
<,,/ 0
(,,1 2
int,,2 5
),,5 6
Enum,,6 :
.,,: ;
	GetValues,,; D
(,,D E
typeof,,E K
(,,K L
TypeOfDocument,,L Z
),,Z [
),,[ \
.,,\ ]
Cast,,] a
<,,a b
TypeOfDocument,,b p
>,,p q
(,,q r
),,r s
.,,s t
Min,,t w
(,,w x
),,x y
),,y z
{-- 
throw.. 
new.. 
BadRequestException.. -
(..- .
$str... V
)..V W
;..W X
}// 
var11 
newUser11 
=11 
_mapper11 !
.11! "
Map11" %
<11% &
User11& *
>11* +
(11+ ,
userDto11, 3
)113 4
;114 5

_dbContext33 
.33 
Users33 
.33 
Add33  
(33  !
newUser33! (
)33( )
;33) *
await44 

_dbContext44 
.44 
SaveChangesAsync44 -
(44- .
)44. /
;44/ 0
return66 
_mapper66 
.66 
Map66 
<66 
UserDTO66 &
>66& '
(66' (
newUser66( /
)66/ 0
;660 1
}77 	
public99 
async99 
Task99 
<99 
UserDTO99 !
>99! "

UpdateUser99# -
(99- .
UserDTO99. 5
userDto996 =
)99= >
{:: 	
var;; 
user;; 
=;; 
await;; 

_dbContext;; '
.;;' (
Users;;( -
.;;- .
AsNoTracking;;. :
(;;: ;
);;; <
.;;< =
FirstOrDefaultAsync;;= P
(;;P Q
x;;Q R
=>;;S U
x;;V W
.;;W X
IdUser;;X ^
==;;_ a
userDto;;b i
.;;i j
IdUser;;j p
);;p q
;;;q r
if<< 
(<< 
user<< 
==<< 
null<< 
)<< 
throw== 
new==  
KeyNotFoundException== .
(==. /
$str==/ G
)==G H
;==H I
var?? 
updatedUser?? 
=?? 
_mapper?? %
.??% &
Map??& )
<??) *
User??* .
>??. /
(??/ 0
userDto??0 7
)??7 8
;??8 9

_dbContext@@ 
.@@ 
Update@@ 
(@@ 
updatedUser@@ )
)@@) *
;@@* +
awaitAA 

_dbContextAA 
.AA 
SaveChangesAsyncAA -
(AA- .
)AA. /
;AA/ 0
returnBB 
_mapperBB 
.BB 
MapBB 
<BB 
UserDTOBB &
>BB& '
(BB' (
updatedUserBB( 3
)BB3 4
;BB4 5
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
UserDTOEE !
>EE! "

DeleteUserEE# -
(EE- .
intEE. 1
idEE2 4
)EE4 5
{FF 	
varGG 
userGG 
=GG 
awaitGG 

_dbContextGG '
.GG' (
UsersGG( -
.GG- .
	FindAsyncGG. 7
(GG7 8
idGG8 :
)GG: ;
;GG; <
ifHH 
(HH 
userHH 
==HH 
nullHH 
)HH 
throwII 
newII  
KeyNotFoundExceptionII .
(II. /
$strII/ K
)IIK L
;IIL M

_dbContextKK 
.KK 
UsersKK 
.KK 
RemoveKK #
(KK# $
userKK$ (
)KK( )
;KK) *
awaitLL 

_dbContextLL 
.LL 
SaveChangesAsyncLL -
(LL- .
)LL. /
;LL/ 0
returnMM 
_mapperMM 
.MM 
MapMM 
<MM 
UserDTOMM &
>MM& '
(MM' (
userMM( ,
)MM, -
;MM- .
}NN 	
}OO 
}PP ·
KC:\Users\Cam\source\repos\cgoncalves\Repository\Utils\AutoMapperProfiles.cs
	namespace 	
TestApiRest
 
. 

Repository  
.  !
Utils! &
{ 
public 

class 
AutoMapperProfiles #
:$ %
Profile& -
{		 
public

 
AutoMapperProfiles

 !
(

! "
)

" #
{ 	
	CreateMap 
< 
UserDTO 
, 
User #
># $
($ %
)% &
;& '
	CreateMap 
< 
User 
, 
UserDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
Book 
, 
BookDTO "
>" #
(# $
)$ %
;% &
	CreateMap 
< 
BookDTO 
, 
Book "
>" #
(# $
)$ %
;% &
	CreateMap 
< 
Order 
, 
OrderDTO $
>$ %
(% &
)& '
;' (
	CreateMap 
< 
OrderDTO 
, 
Order  %
>% &
(& '
)' (
;( )
	CreateMap 
< 
OrderDetail !
,! "
OrderDetailDTO# 1
>1 2
(2 3
)3 4
;4 5
	CreateMap 
< 
OrderDetailDTO $
,$ %
OrderDetail& 1
>1 2
(2 3
)3 4
;4 5
} 	
} 
} 